<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe</title>
    <style>
        .cell {
            width: 50px;
            height: 50px;
            border: 1px solid black;
            display: inline-block;
            text-align: center;
            line-height: 50px;
            cursor: pointer;
        }
        .current-player {
            font-weight: bold;
        }
        .blink {
            animation: blink 1s linear infinite;
        }
        @keyframes blink {
            50% {
                background-color: black;
                color: white;
            }
        }
    </style>
</head>
<body>
<h1>Tic Tac Toe</h1>
<div id="currentPlayer" class="current-player"></div>
<div id="message"></div>
<div id="board">
    <!-- Game board will be dynamically generated here -->
</div>
<script>
    const numRows = {{ grid_size }};
    const numCols = {{ grid_size }};
    let currentPlayer = '{{ current_player }}';
    document.getElementById('currentPlayer').innerText = `Current Player: ${currentPlayer}`;

    const board = document.getElementById('board');
    const messageDiv = document.getElementById('message');
    const cells = [];
    for (let row = 0; row < numRows; row++) {
        cells[row] = [];
        for (let col = 0; col < numCols; col++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.id = `cell${row}-${col}`;
            cell.onclick = () => makeMove(row, col);
            cells[row][col] = cell;
            board.appendChild(cell);
        }
        board.appendChild(document.createElement('br'));
    }

    function makeMove(row, col) {
        fetch('/make_move', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                row: row,
                col: col
            })
        })
        .then(response => response.json())
        .then(data => {
            const result = data.result;
            const winner = data.winner;
            if (result === 'success') {
                currentPlayer = data.current_player;
                document.getElementById('currentPlayer').innerText = `Current Player: ${currentPlayer}`;
                cells[row][col].innerText = currentPlayer === '{{ current_player }}' ? 'X' : 'O';
            } else if (result === 'win') {
                messageDiv.innerText = `Congratulations! ${winner} wins!`;
            } else if (result === 'draw') {
                messageDiv.innerText = 'It\'s a draw!';
            } else if (result === 'occupied') {
                messageDiv.innerText = 'This cell is already occupied. Please choose another one.';
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
</script>
</body>
</html>
